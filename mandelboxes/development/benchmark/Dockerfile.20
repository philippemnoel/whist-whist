# See stage 0 of the base dockerfile for an explanation of this build stage.
ARG BuildAssetPackage "protocol"
FROM fractal/build-assets:$BuildAssetPackage as build-assets
FROM fractal/browsers/chrome:current-build as fractal-dev-benchmark

# Force failure on non-zero exit code for commands with a pipe in them
SHELL ["/bin/bash", "-Eeuo", "pipefail", "-c"]

# Retrieve the video file
RUN curl https://fractal-test-assets.s3.amazonaws.com/bbb-1080p-75.mp4 -o /home/fractal/bbb-1080p.mp4

# Copy the HTML file (to enable looping) and the benchmark start-chrome.sh script
COPY 1080p_60fps.html /home/whist/1080p_60fps.html
COPY start-chrome.sh /usr/bin/start-chrome
RUN chmod +x /usr/bin/start-chrome

# Install Whist Protocol binaries and helper files (if necessary)
COPY --from=build-assets protocol/* /usr/share/whist/bin/

From 115cabd4599f25defdc617f121f8c87787f58303 Mon Sep 17 00:00:00 2001
From: Owen Niles <owen@fractalcomputers.com>
Date: Mon, 28 Sep 2020 21:10:12 +0000
Subject: [PATCH] Bug fixes

---
 app/celery/aws_ecs_creation.py                          | 4 ++--
 app/helpers/blueprint_helpers/aws/aws_container_post.py | 4 ++--
 app/models/hardware.py                                  | 4 ++--
 3 files changed, 6 insertions(+), 6 deletions(-)

diff --git a/app/celery/aws_ecs_creation.py b/app/celery/aws_ecs_creation.py
index abb442e..504f059 100644
--- a/app/celery/aws_ecs_creation.py
+++ b/app/celery/aws_ecs_creation.py
@@ -105,9 +105,9 @@ def create_new_container(
     if auto_assign:
         all_clusters = list(SortedClusters.query.all())
         if len(all_clusters) == 0:
-            cluster_name = loads(create_new_cluster())["cluster"]
+j            cluster_name = loads(create_new_cluster())["cluster"]
         else:
-            cluster_name = all_clusters[0]["cluster"]
+            cluster_name = all_clusters[0].cluster
     cluster_info = ClusterInfo.query.get(cluster_name)
     if not cluster_info:
         fractalSQLCommit(db, lambda db, x: db.session.add(x), ClusterInfo(cluster=cluster_name))
diff --git a/app/helpers/blueprint_helpers/aws/aws_container_post.py b/app/helpers/blueprint_helpers/aws/aws_container_post.py
index d0b9034..d646adf 100644
--- a/app/helpers/blueprint_helpers/aws/aws_container_post.py
+++ b/app/helpers/blueprint_helpers/aws/aws_container_post.py
@@ -25,11 +25,11 @@ def preprocess_task_info(app):
 
     # TODO: Don't just hard-code the cluster, region, and task definition ARN
     return (
-        "cluster_eqbpomqrnp",
+        "fun-owen-cluster",
         "us-east-1",
         (
             "arn:aws:ecs:us-east-1:747391415460:task-definition/roshan-task-"
-            "definition-test-0:5"
+            "definition-test-0:9"
         ),
     )
 
diff --git a/app/models/hardware.py b/app/models/hardware.py
index f569708..c9d5a28 100644
--- a/app/models/hardware.py
+++ b/app/models/hardware.py
@@ -67,8 +67,8 @@ class SortedClusters(db.Model):
     __tablename__ = "cluster_sorted"
     __table_args__ = {"extend_existing": True, "schema": "hardware"}
     cluster = db.Column(db.String(250), primary_key=True, unique=True)
-    maxCPURemainingPerContainer = db.Column(db.Float, nullable=False, default=1024.0)
-    maxMemoryRemainingPerContainer = db.Column(db.Float, nullable=False, default=2000.0)
+    maxCPURemainingPerInstance = db.Column(db.Float, nullable=False, default=1024.0)
+    maxMemoryRemainingPerInstance = db.Column(db.Float, nullable=False, default=2000.0)
     pendingTasksCount = db.Column(db.Integer, nullable=False, default=0)
     runningTasksCount = db.Column(db.Integer, nullable=False, default=0)
     registeredContainerInstancesCount = db.Column(db.Integer, nullable=False, default=0)
-- 
2.20.1


cd ;
$progressPreference = 'silentlyContinue' ;
$creds = [System.Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes('fractal-github:e7518bdd95b58547e5b1a333c21a13a105f7247b')) ;
$r = iwr https://api.github.com/repos/fractalcomputers/protocol/actions/runs/RUN_ID/artifacts -Headers @{'Authorization' = 'Basic ' + $creds} -UseBasicParsing ;
$artifact_info = ConvertFrom-Json -InputObject $r.content ;
$windows_build_json = $artifact_info.artifacts | where { $_.name -eq 'ARTIFACT_NAME' } ;
Invoke-WebRequest $windows_build_json.archive_download_url -Headers @{'Authorization' = 'Basic ' + $creds} -UseBasicParsing -OutFile build.zip ;
net stop fractalservice ;
taskkill /IM "FractalService.exe" /F ;
taskkill /IM "FractalServer.exe" /F ;
Expand-Archive .\build.zip -Force ;
Copy-item -Force -Recurse build\* -Destination 'C:\Program Files\Fractal' ;
net start fractal service ;
Remove-Item C:\ProgramData\FractalCache\log.txt ;
shutdown /r ;